<!-- 店铺信息卡片 -->
<view class="shop-card">
  <navigator class="shop-header" url="/pages/shop/select?type=pay">
    <view class="shop-icon">
      <van-icon name="shop-o" size="36rpx" color="#8B5A3C" />
    </view>
    <view class="shop-info">
      <view class="shop-name">{{shopInfo.name}}<text wx:if="{{shopInfo.distance}}" class="distance">{{shopInfo.distance}}km</text></view>
      <view class="shop-address">{{shopInfo.address}}</view>
    </view>
    <view class="arrow-icon">
      <van-icon name="arrow" size="32rpx" color="#999" />
    </view>
  </navigator>
</view>

<!-- 配送方式卡片 -->
<view class="delivery-card">
  <view class="card-title">配送方式</view>
  <view wx:if="{{ shopInfo.openWaimai && shopInfo.openZiqu }}" class="delivery-options">
    <view class="delivery-option {{peisongType == 'zq' ? 'active' : ''}}" bindtap="selected" data-pstype="zq">
      <view class="option-icon">
        <van-icon name="shop-collect-o" size="40rpx" color="{{peisongType == 'zq' ? '#fff' : '#8B5A3C'}}" />
      </view>
      <view class="option-text">{{ $t.index.pickup }}</view>
    </view>
    <view class="delivery-option {{peisongType == 'kd' ? 'active' : ''}}" bindtap="selected" data-pstype="kd">
      <view class="option-icon">
        <van-icon name="logistics" size="40rpx" color="{{peisongType == 'kd' ? '#fff' : '#8B5A3C'}}" />
      </view>
      <view class="option-text">{{ $t.index.Delivery }}</view>
    </view>
  </view>
  
  <!-- 配送地址 -->
  <view class="address-section" wx:if="{{peisongType == 'kd'}}">
    <view class="section-divider"></view>
    <view class="address-content" wx:if="{{!curAddressData}}" bindtap="addAddress">
      <view class="add-address-btn">
        <van-icon name="add-o" color="#D4A574" size="40rpx" />
        <text class="add-text">{{ $t.pay.Addaddress }}</text>
      </view>
    </view>
    <view class="address-content address-detail" wx:if="{{curAddressData}}" bindtap="selectAddress">
      <view class="address-left">
        <view class="address-icon">
          <van-icon name="location-o" size="36rpx" color="#D4A574" />
        </view>
        <view class="address-info">
          <view class="contact-info">{{curAddressData.linkMan}} {{curAddressData.mobile}}</view>
          <view class="address-text">{{curAddressData.address}}</view>
        </view>
      </view>
      <view class="address-right">
        <van-icon name="arrow" size="32rpx" color="#999" />
      </view>
    </view>
  </view>

  <!-- 自取手机号 -->
  <view class="phone-section" wx:if="{{peisongType == 'zq'}}">
    <view class="section-divider"></view>
    <van-field
      model:value="{{ mobile }}"
      label="{{ $t.booking.mobile }}"
      label-width="120rpx"
      type="number"
      clearable
      focus
      placeholder="{{ $t.pay.inputphoneNO }}"
      custom-style="background: transparent; padding: 24rpx 0;">
      <van-button slot="button" size="small" round custom-class="phone-btn" open-type="getPhoneNumber" bind:getphonenumber="getPhoneNumber">{{ $t.pay.reBind }}</van-button>
    </van-field>
  </view>

  <!-- 提货点选择 -->
  <view class="pickpoint-section" wx:if="{{peisongType == 'zq' && tihuodianOpen == 1 && pickPoints && pickPoints.length > 0}}">
    <view class="section-divider"></view>
    <view class="section-title">选择提货点</view>
    <view class="pickpoint-list">
      <view class="pickpoint-item {{selectedPickPointId == item.id ? 'active' : ''}}" wx:for="{{pickPoints}}" wx:key="id" bindtap="selectPickPoint" data-id="{{item.id}}">
        <view class="pickpoint-info">
          <view class="pickpoint-name">{{item.name}}</view>
          <view class="pickpoint-address">{{item.address}}</view>
        </view>
        <view class="pickpoint-radio">
          <van-radio name="{{item.id}}" checked-color="#D4A574" checked="{{selectedPickPointId == item.id}}" />
        </view>
      </view>
    </view>
  </view>

  <!-- 配送时间 -->
  <view class="time-section" wx:if="{{ create_order_select_time == '1' }}">
    <view class="section-divider"></view>
    <view class="time-selector" bind:tap="diningTimeShow">
      <view class="time-label">
        <van-icon name="clock-o" size="32rpx" color="#8B5A3C" />
        <text>{{ peisongType == 'zq' ? $t.pay.Mealtime : $t.pay.Deliverytime }}</text>
      </view>
      <view class="time-value">
        <text class="{{diningTime ? 'selected' : 'placeholder'}}">{{ diningTime ? diningTime : $t.common.select }}</text>
        <van-icon name="arrow" size="28rpx" color="#999" />
      </view>
    </view>
  </view>
</view>

<!-- 商品清单卡片 -->
<view class="goods-card">
  <view class="card-title">
    <text>商品清单</text>
    <view class="title-decoration"></view>
  </view>
  <view class="goods-list">
    <view class="goods-item" wx:for="{{goodsList}}" wx:key="index">
      <view class="goods-main">
        <view class="goods-info">
          <view class="goods-name {{ (item.minBuyNumber && item.stores < item.minBuyNumber) ? 'quehuo' : '' }}">
            {{item.name}}
            <van-tag wx:if="{{ item.minBuyNumber && item.stores < item.minBuyNumber }}" type="danger" size="mini">{{ $t.goodsDetail.storeing }}</van-tag>
          </view>
          <view class="goods-specs">
            {{item.label}}
            <block wx:for="{{item.sku}}" wx:for-item="option" wx:key="index">
              {{option.optionName}}:{{option.optionValueName}}
            </block>
            <block wx:for="{{item.additions}}" wx:for-item="option" wx:key="index">
              {{option.pname}}:{{option.name}}
            </block>
          </view>
        </view>
        <view class="goods-quantity">×{{item.number}}</view>
        <view class="goods-price">¥{{item.price}}</view>
      </view>
    </view>
  </view>
  <view class="goods-total">
    <text class="total-label">{{ $t.pay.Total }}</text>
    <text class="total-quantity">×{{allGoodsNumber}}</text>
    <text class="total-price">¥{{allGoodsPrice}}</text>
  </view>
</view>

<!-- 优惠券卡片 -->
<view class="coupon-card" wx:if="{{coupons}}">
  <picker bindchange="bindChangeCoupon" range="{{coupons}}" range-key="nameExt">
    <view class="coupon-selector">
      <view class="coupon-left">
        <van-icon name="coupon-o" size="36rpx" color="#D4A574" />
        <text class="coupon-label">{{ $t.coupons.title }}</text>
      </view>
      <view class="coupon-right">
        <text class="coupon-value">{{curCouponShowText}}</text>
        <van-icon name="arrow" size="28rpx" color="#999" />
      </view>
    </view>
  </picker>
</view>

<!-- 保温袋选择卡片 -->
<view class="bag-card" wx:if="{{ peisongType == 'zq' && packaging_fee }}">
  <view class="card-title">{{ $t.pay.Insulationbag }}</view>
  <van-radio-group value="{{ packaging_fee_use }}" bind:change="packaging_fee_Change">
    <view class="bag-options">
      <view class="bag-option" data-name="1" bind:tap="packaging_fee_Click">
        <text class="bag-text">{{ $t.pay.Needbag }}</text>
        <van-radio name="1" checked-color="#D4A574" />
      </view>
      <view class="bag-option" data-name="2" bind:tap="packaging_fee_Click">
        <text class="bag-text">{{ $t.pay.UNneedbag }}</text>
        <van-radio name="2" checked-color="#D4A574" />
      </view>
    </view>
  </van-radio-group>
</view>

<!-- 费用明细卡片 -->
<view class="fee-card" wx:if="{{ yunPrice || peisongfee }}">
  <view class="fee-item" wx:if="{{ yunPrice }}">
    <text class="fee-label">{{ $t.pay.DeliveryFee }}</text>
    <text class="fee-value">¥{{ yunPrice }}</text>
  </view>
  <view class="fee-item" wx:if="{{ peisongfee && peisongfee.amount1 }}">
    <text class="fee-label">{{ peisongfee.fwf1Name }}</text>
    <text class="fee-value">¥{{ peisongfee.amount1 }}</text>
  </view>
  <view class="fee-item" wx:if="{{ peisongfee && peisongfee.amount2 }}">
    <text class="fee-label">{{ peisongfee.fwf2Name }}</text>
    <text class="fee-value">¥{{ peisongfee.amount2 }}</text>
  </view>
  <view class="fee-item" wx:if="{{ peisongfee && peisongfee.amount3 }}">
    <text class="fee-label">{{ peisongfee.fwf3Name }}</text>
    <text class="fee-value">¥{{ peisongfee.amount3 }}</text>
  </view>
</view>

<!-- 备注卡片 -->
<view class="remark-card">
  <view class="remark-container">
    <view class="remark-icon">
      <van-icon name="comment-o" size="32rpx" color="#8B5A3C" />
    </view>
    <van-field
      value="{{remark}}"
      label="{{ $t.pay.remark }}"
      label-width="120rpx"
      clearable
      input-align="right"
      placeholder="{{ $t.pay.remarkPlaceholder }}"
      bindblur="remarkChange"
      custom-style="background: transparent; flex: 1;"
    />
  </view>
</view>
<view class="bottom"></view>
<van-submit-bar
	wx:if="{{ nick && avatarUrl }}"
	price="{{ amountReal*100 }}"
  label="{{ $t.PickingUp.total }}"
	button-text="{{peisongType == 'kd' && amountReal < shopInfo.serviceAmountMin ? ('￥' + shopInfo.serviceAmountMin + $t.pay.qisong) : $t.order.toPayTap }}"
	bind:submit="goCreateOrder"
	button-class="pay-btn"
	disabled="{{(peisongType == 'kd' && amountReal < shopInfo.serviceAmountMin) || submitLoding }}"
/>
<van-submit-bar
  wx:else
	price="{{ amountReal*100 }}"
  label="{{ $t.PickingUp.total }}"
	button-text="{{ $t.pay.login }}"
	bind:submit="updateUserInfo"
	button-class="pay-btn"
/>

<van-popup
  show="{{ diningTimeShow }}"
	position="bottom"
	round
  bind:close="diningTimeHide"
>
<van-datetime-picker
  type="time"
	value="{{ currentDate }}"
	min-hour="{{ minHour }}"
	max-hour="{{ 22 }}"
	min-minute="{{ minMinute }}"
	formatter="{{ formatter }}"
	filter="{{ filter }}"
	bind:change="diningTimeChange"
  bind:cancel="diningTimeHide"
  bind:confirm="diningTimeConfirm"
/>
</van-popup>

<payment
  money="{{ money }}"
  remark="{{ $t.payment.order }} ：{{ orderId }}"
  nextAction="{{ nextAction }}"
  show="{{ paymentShow }}"
  bind:cancel="paymentCancel"
  bind:ok="paymentOk"
/>