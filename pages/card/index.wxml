<view class="page-container">
  <!-- é¡¶éƒ¨è£…é¥°èƒŒæ™¯ -->
  <view class="page-header-bg"></view>
  
  <van-sticky>
    <view class="custom-tabs-wrapper">
      <van-tabs active="{{ active }}" bind:change="tabChange" color="#A0826D" title-active-color="#A0826D" title-inactive-color="#999">
        <van-tab title="{{ $t.card.buy }}"></van-tab>
        <van-tab title="{{ $t.card.my }}"></van-tab>
      </van-tabs>
    </view>
  </van-sticky>

  <view wx:if="{{ active == 0 }}" class="tab-content">
    <!-- è½®æ’­å›¾ -->
    <view wx:if="{{ banners }}" class="banner-section">
      <swiper class="swiper-banner" indicator-dots indicator-color="rgba(255,255,255,0.5)" indicator-active-color="#fff" autoplay circular>
        <swiper-item wx:for="{{ banners }}" wx:key="id">
          <view class="banner-wrapper">
            <image class="banner-image" mode="aspectFill" bindtap="tapBanner" data-url="{{item.linkUrl}}" src="{{item.picUrl}}" />
          </view>
        </swiper-item>
      </swiper>
    </view>

    <!-- ç¤¼å“å¡åˆ—è¡¨ -->
    <view class="card-list">
      <van-empty wx:if="{{ !cardList }}" description="{{ $t.card.empty }}" />
      <view class="gift-card-item" wx:for="{{ cardList }}" wx:key="id">
        <view class="card-container">
          <view class="card-image-wrapper">
            <image class="card-image" src="{{ item.pic }}" mode="aspectFill"></image>
            <view class="card-shine"></view>
          </view>
          <view class="card-content">
            <view class="card-title">{{ item.name }}</view>
            <view class="card-footer">
              <view class="price-area">
                <text class="price-symbol">Â¥</text>
                <text class="price-value">{{ item.price }}</text>
              </view>
              <view class="buy-btn" data-item="{{ item }}" bindtap="buy">
                <text>{{ $t.card.buy2 }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view wx:if="{{ active == 1 }}" class="tab-content">
    <view class="my-card-list">
      <!-- å…‘æ¢å¡åˆ¸å…¥å£ -->
      <navigator url="/pages/card/exchange" hover-class="none">
        <view class="exchange-entry">
          <view class="exchange-icon">ğŸ</view>
          <view class="exchange-info">
            <view class="exchange-title">{{ $t.card.excharge }}</view>
            <view class="exchange-desc">è¾“å…¥å…‘æ¢ç é¢†å–ç¤¼å“å¡</view>
          </view>
          <view class="exchange-arrow">â†’</view>
        </view>
      </navigator>

      <van-empty wx:if="{{ !cardMyList }}" description="{{ $t.card.empty }}" />
      
      <view class="my-gift-card" wx:for="{{ cardMyList }}" wx:key="id">
        <view class="my-card-wrapper">
          <view class="my-card-image-box">
            <image class="my-card-image" src="{{ item.cardInfo.pic }}" mode="aspectFill"></image>
            <view class="card-overlay">
              <view class="card-amount-box">
                <view class="expire-date">{{ $t.coupons.expire }}: {{ item.dateEnd }}</view>
                <view class="card-amount">
                  <text wx:if="{{ item.type == 0 }}">{{ item.amount }}</text>
                  <text wx:if="{{ item.type == 1 }}">Â¥{{ item.amount }}</text>
                  <text class="unit" wx:if="{{ item.type == 0 }}">{{ $t.card.times }}</text>
                </view>
              </view>
            </view>
            <view wx:if="{{ !item.isActive && !item.fromUid && item.shareToken }}" class="card-status-tag">
              {{ $t.card.sending }}
            </view>
          </view>
          
          <view class="my-card-info">
            <view class="card-name">{{ item.cardInfo.name }}</view>
            
            <!-- æœªæ¿€æ´»ä¸”æœªåˆ†äº« - æ˜¾ç¤ºåˆ†äº«æŒ‰é’® -->
            <view wx:if="{{ !item.isActive && !item.fromUid && !item.shareToken }}" class="card-actions">
              <view class="action-btn primary" data-item="{{ item }}" bindtap="sendUser">
                <text>{{ $t.card.cardShareOpen }}</text>
              </view>
            </view>
            
            <!-- æœªæ¿€æ´»ä¸”å·²åˆ†äº« - æ˜¾ç¤ºå–æ¶ˆåˆ†äº«æŒ‰é’® -->
            <view wx:elif="{{ !item.isActive && !item.fromUid && item.shareToken }}" class="card-actions">
              <view class="action-btn danger" data-item="{{ item }}" bindtap="cardShareClose">
                <text>{{ $t.card.cardShareClose }}</text>
              </view>
            </view>
            
            <!-- å·²æ¿€æ´» - æ˜¾ç¤ºä½¿ç”¨è®°å½•å…¥å£ -->
            <view wx:else class="card-actions">
              <navigator url="/pages/card/logs?cardId={{ item.id }}" hover-class="none">
                <view class="action-btn outline">
                  <text>{{ $t.card.logs }}</text>
                </view>
              </navigator>
              <view wx:if="{{ item.fromUser }}" class="gift-from">
                <image class="from-avatar" src="{{ item.fromUser.avatarUrl || '/images/who.png' }}" mode="aspectFill"></image>
                <text class="from-name">{{ item.fromUser.nick || 'å¾®ä¿¡ç”¨æˆ·' }}é€å‡º</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<payment
  money="{{ money }}"
  remark="{{ remark }}"
  nextAction="{{ nextAction }}"
  show="{{ paymentShow }}"
  useCard="{{ false }}"
  bind:cancel="paymentCancel"
  bind:ok="paymentOk"
/>